#include <reg932.h>

sbit wave = P1^7;

 void spongebob();
 void setTempo(int tempo);
 void playNote(int note);
 void TIMR1ISR();
 void playnotetime(int note, unsigned int n);

#define note_A4 4189
#define note_C5 3523
#define note_D5 3135
#define note_C4 7045
#define note_D4 6277
#define note_E4 5592
#define note_F4 5278
#define note_F3 10556
#define note_D4b 6650
#define note_D4s 5924 
#define note_A5 2095 
#define note_B5 1866
#define note_C6 1761
#define note_D6 1569
#define note_E6 1398

unsigned int quarterNote;
unsigned int wholeNote;
unsigned int halfNote;
unsigned int eighthNote;

 
void main() 
{
  P2M1 = 0x00;
  P1M1 = 0x00;
  P0M1 = 0x00;

  TMOD = 0x11;
  IEN1 = 0x88;
  spongebob();
}
 
void spongebob()
{
	setTempo(BINC);

	playnotetime(note_D4b, quarterNote);
	playnotetime(note_D4b, quarterNote);
	playnotetime(note_D4b, quarterNote);
	playnotetime(note_D4, eighthNote);
	playnotetime(note_C4, eighthNote);
	playnotetime(note_D4s, eighthNote);
	playnotetime(note_C4, eighthNote);
	playnotetime(note_A4, eighthNote);
	playnotetime(note_F3, eighthNote);
	playnotetime(note_A4, eighthNote);
	playnotetime(note_C4, eighthNote);
	playnotetime(note_D4, eighthNote);
	playnotetime(note_C4, eighthNote);
	playnotetime(note_A4, quarterNote);
	playnotetime(note_F4, eighthNote);
	playnotetime(note_E4, eighthNote);
	playnotetime(note_F4, eighthNote);
	playnotetime(note_D4, eighthNote);
	playnotetime(note_C4, eighthNote);
	playnotetime(note_D4, eighthNote);
	playnotetime(note_C4, eighthNote);
	playnotetime(note_A4, eighthNote);
	playnotetime(note_F4, eighthNote);
	playnotetime(note_A4, eighthNote);
	playnotetime(note_F4, eighthNote);
}




void setTempo(int tempo)
{
  quarterNote = ((60/tempo) * 7373000) / 2;
  wholeNote= 4 * quarterNote;
  halfNote = 2 * quarterNote;
  eighthNote = quarterNote / 2; 
}


void TIMR1ISR() interrupt 3
{
	wave = ~wave;
	TF1 = 0;
}

void playnotetime(int note, unsigned int n)
{
	unsigned int i;
	playNote(note);
	for(i = 0; i<n; i++);
}

void playNote(int note)
{
	//wave = ~wave;
	//TIMR1Delay(note);
	TMOD = 0x10;
	TH1 = -note >> 8;
	TL1 = -note;
	TF1 = 0;
	TR1 = 1;
}


void display_BPM(char one, char two, char three)
{

	uart_init();

	while (1)
        {
         if (beats == 0)
          {
            uart_transmit(one);
            uart_transmit(two);
	    uart_transmit(three);
            uart_transmit(' ');
            uart_transmit('B');
            uart_transmit('P');
	    uart_transmit('M');
	    while (beats==0);
	  }
	}
}
